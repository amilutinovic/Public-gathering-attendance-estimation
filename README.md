# Public-gathering-attendance-estimation


This project provides a reproducible pipeline for **estimating the number of people at public gatherings** using aerial images (e.g., drone footage).  
The method is based on **grid partitioning, stratified sampling, Neyman allocation**, and **automatic dot counting** inside selected cells.  
Documentation and examples are included.
This implementation was applied for the **estimation of the protest at Slavija, Belgrade, on March 15, 2025**.

---

## Project Structure

### `code/`
Contains R and Python scripts for each stage of the pipeline:
- **grid.R** – builds rectangular grids (cells) for each image  
- **draw_stratum.R** – visualization of strata and inclusion/exclusion zones  
- **sampling_pipeline.R** – pilot sampling, Neyman allocation, main sampling  
- **estimation.R** – estimation of totals and confidence intervals  
- **stratum.py** – automatic stratum assignment (density scores)  
- **auto-count.py** – automatic counting of dots (detections) inside selected cells  

---

### `outputs/`
#### `grid_output/`
Intermediate files generated by grid and stratification steps:
- **grid images** – PNG overlays with grid cells  
- **strata_map.csv** – raw grid with cell coordinates and metadata  
- **strata_map_auto.csv** – grid with automatic stratum assignment  
- **strata_viz/** – visualization of stratified cells (by density and inclusion flag)
  
#### `sampling_outputs/`
Results of pilot and main sampling:
- **pilot_to_count.csv** – selected pilot cells for manual/automatic counting  
- **pilot_overlays_image/** – overlays showing pilot cells on original images  
- **pilot_to_count_filled.csv** – pilot dataset filled with counts (from auto-count)  
- **preview_images_pilot/** – per-cell and per-image previews of pilot counting  
- **main_to_count.csv** – selected main sample cells (after Neyman allocation)  
- **main_overlays_image/** – overlays showing main sample cells  
- **main_to_count_filled.csv** – main dataset filled with counts  
- **preview_images_main/** – previews of counting results for main sampling

---

### `images/`
Starting disjoint images (cropped frames from drone footage), used as input for grid creation.  

---

### `documentation/`
LaTeX and PDF documentation (in Serbian), describing methodology, implementation, and results.  

---

## Workflow Summary
1. **Grid creation (R):** divide each input image into 40×40 rectangular cells.  
2. **Automatic stratification (Python):** classify cells into 3 strata by density features; exclude dark/uninformative cells.  
3. **Pilot sampling (R):** select 15 cells per stratum; count dots; estimate variance.  
4. **Neyman allocation (R):** distribute target sample size (≈180 cells per image) proportionally to $N_h s_h$.  
5. **Main sampling (R):** select cells according to Neyman allocation; run automatic counting.  
6. **Estimation (R):** compute stratified total estimates and 95% confidence intervals, both per image and overall.  

---

## Output
- **Numerical results:** per-image and overall total estimates with confidence intervals.  
- **Visual results:** overlays showing which cells were sampled (pilot and main), and clean previews of detected dots.  

---

## Conclusion
Independent reports estimated between **275,000 and 325,000 participants** at the protest in Belgrade on March 15, 2025, while the Ministry of Interior reported a significantly lower figure of around **107,000**.  
Our own estimation, based only on the Slavija area and using the proposed methodology (grid-based stratified sampling with automated counting), resulted in approximately **170,000 people**.  

It is important to note that this result is **not directly comparable** with city-wide estimates, as it covers only a subset of locations. However, it provides a transparent, reproducible, and localized assessment of crowd density and attendance.

---

## Notes
- Current documentation is written in **Serbian** (PDF and LaTeX).  
- The pipeline is generalizable to other locations, resolutions, and crowd densities.

---

## Authors

Anja Milutinović 235/2021 \
Lana Matić 143/2021
